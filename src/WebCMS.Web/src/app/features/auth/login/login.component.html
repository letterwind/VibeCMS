<div
  class="container-fluid vh-100 d-flex align-items-center justify-content-center bg-light"
>
  <div class="card shadow" style="width: 400px">
    <div class="card-body p-4">
      <h4 class="card-title text-center mb-4">WebCMS 管理系統</h4>

      @if (errorMessage()) {
        <div class="alert alert-danger" role="alert">
          {{ errorMessage() }}
        </div>
      }

      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label for="account" class="form-label"
            >帳號 <span class="text-danger">*</span></label
          >
          <input
            type="text"
            class="form-control"
            id="account"
            formControlName="account"
            placeholder="請輸入帳號"
            [class.is-invalid]="isFieldInvalid('account')"
          />
          <app-validation-error
            [control]="loginForm.get('account')"
            [fieldName]="'帳號'"
          >
          </app-validation-error>
        </div>

        <div class="mb-3">
          <label for="password" class="form-label"
            >密碼 <span class="text-danger">*</span></label
          >
          <input
            type="password"
            class="form-control"
            id="password"
            formControlName="password"
            placeholder="請輸入密碼"
            [class.is-invalid]="isFieldInvalid('password')"
          />
          <app-validation-error
            [control]="loginForm.get('password')"
            [fieldName]="'密碼'"
          >
          </app-validation-error>
        </div>

        <div class="mb-3">
          <label for="captcha" class="form-label"
            >驗證碼 <span class="text-danger">*</span></label
          >
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              id="captcha"
              formControlName="captcha"
              placeholder="請輸入驗證碼"
              [class.is-invalid]="isFieldInvalid('captcha')"
            />
            <span
              class="input-group-text p-0"
              style="cursor: pointer"
              (click)="refreshCaptcha()"
              title="點擊重新整理驗證碼"
            >
              @if (captchaImage()) {
                <img
                  [src]="'data:image/png;base64,' + captchaImage()"
                  alt="驗證碼"
                  style="height: 38px"
                />
              } @else {
                <span class="px-3">載入中...</span>
              }
            </span>
          </div>
          <app-validation-error
            [control]="loginForm.get('captcha')"
            [fieldName]="'驗證碼'"
          >
          </app-validation-error>
        </div>

        <button
          type="submit"
          class="btn btn-primary w-100"
          [disabled]="isLoading()"
        >
          @if (isLoading()) {
            <span
              class="spinner-border spinner-border-sm me-2"
              role="status"
            ></span>
          }
          登入
        </button>
      </form>
    </div>
  </div>
</div>
